---
title: Recipe é…ç½®ç³»ç»Ÿ
description: å£°æ˜å¼ Agent é…ç½®å’Œå¯å¤ç”¨æ¨¡æ¿
navigation:
  icon: i-lucide-book-open
---

# Recipe é…ç½®ç³»ç»Ÿ

Recipe æ˜¯ Aster çš„å£°æ˜å¼ Agent é…ç½®ç³»ç»Ÿï¼Œå…è®¸é€šè¿‡ YAML æ–‡ä»¶å®šä¹‰å¯å¤ç”¨çš„ Agent æ¨¡æ¿ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

Recipe å°† Agent é…ç½®æŠ½è±¡ä¸ºå£°æ˜å¼çš„ YAML æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼š

- ğŸ“ **æŒ‡ä»¤å’Œæç¤º** - ç³»ç»Ÿæç¤ºå’Œåˆå§‹æ¶ˆæ¯
- ğŸ”§ **å·¥å…·é…ç½®** - å¯ç”¨çš„å·¥å…·åˆ—è¡¨
- ğŸ”Œ **MCP æ‰©å±•** - å¤–éƒ¨æœåŠ¡é›†æˆ
- ğŸ“Š **å‚æ•°åŒ–** - å¯é…ç½®çš„å‚æ•°
- ğŸ” **æƒé™æ¨¡å¼** - å·¥å…·å®¡æ‰¹ç­–ç•¥

## ğŸ“‹ Recipe ç»“æ„

```yaml
version: "1.0"
title: My Assistant
description: åŠ©æ‰‹æè¿°

# ç³»ç»ŸæŒ‡ä»¤
instructions: |
  ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åŠ©æ‰‹...

# åˆå§‹æç¤ºï¼ˆå¯é€‰ï¼‰
prompt: è¯·å¸®æˆ‘å®Œæˆä»»åŠ¡

# å¯ç”¨çš„å·¥å…·
tools:
  - Read
  - Write
  - Bash
  - Search

# MCP æ‰©å±•
extensions:
  - type: stdio
    name: github
    cmd: npx
    args: ["-y", "@anthropics/mcp-github"]
    env:
      GITHUB_TOKEN: "${GITHUB_TOKEN}"

# å¯é…ç½®å‚æ•°
parameters:
  - key: project_name
    input_type: string
    requirement: required
    description: é¡¹ç›®åç§°

# æƒé™æ¨¡å¼
permission_mode: smart_approve

# å»ºè®®æ´»åŠ¨
activities:
  - å®¡æŸ¥ä»£ç 
  - å†™æµ‹è¯•
  - ä¿®å¤ Bug

# ä½œè€…ä¿¡æ¯
author:
  name: Your Name
  url: https://github.com/you
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä» YAML åŠ è½½

```go
import "github.com/astercloud/aster/pkg/recipe"

// åŠ è½½ Recipe
r, err := recipe.Load("./recipes/code-review.yaml")
if err != nil {
    log.Fatal(err)
}

// éªŒè¯ Recipe
if err := r.Validate(); err != nil {
    log.Printf("éªŒè¯è­¦å‘Š: %v", err)
}

fmt.Printf("æ ‡é¢˜: %s\n", r.Title)
fmt.Printf("å·¥å…·: %v\n", r.Tools)
```

### ä½¿ç”¨ Builder åˆ›å»º

```go
r := recipe.NewBuilder().
    WithTitle("Code Review Assistant").
    WithDescription("ä¸“ä¸šçš„ä»£ç å®¡æŸ¥åŠ©æ‰‹").
    WithVersion("1.0").
    WithInstructions(`ä½ æ˜¯ä¸“ä¸šçš„ä»£ç å®¡æŸ¥ä¸“å®¶ã€‚
è¯·ä»”ç»†æ£€æŸ¥ä»£ç è´¨é‡ã€å®‰å…¨æ€§å’Œæœ€ä½³å®è·µã€‚`).
    WithTools("Read", "List", "Search", "Bash").
    WithPermissionMode(recipe.PermissionModeSmartApprove).
    WithActivities(
        "å®¡æŸ¥ PR ä»£ç ",
        "æ£€æŸ¥å®‰å…¨æ¼æ´",
        "ä¼˜åŒ–æ€§èƒ½",
    ).
    Build()

// ä¿å­˜ä¸º YAML
r.Save("./my-recipe.yaml")
```

## ğŸ”Œ MCP æ‰©å±•

### stdio ç±»å‹

å¯åŠ¨å¤–éƒ¨è¿›ç¨‹ä½œä¸º MCP æœåŠ¡ï¼š

```yaml
extensions:
  - type: stdio
    name: github
    description: GitHub API é›†æˆ
    cmd: npx
    args:
      - "-y"
      - "@anthropics/mcp-github"
    env:
      GITHUB_TOKEN: "${GITHUB_TOKEN}"
    timeout: 30
    enabled: true
```

### sse ç±»å‹

è¿æ¥è¿œç¨‹ MCP æœåŠ¡ï¼š

```yaml
extensions:
  - type: sse
    name: search
    description: æœç´¢æœåŠ¡
    url: http://localhost:3000/mcp
    timeout: 10
    enabled: true
```

### builtin ç±»å‹

ä½¿ç”¨å†…ç½®æ‰©å±•ï¼š

```yaml
extensions:
  - type: builtin
    name: filesystem
    description: æ–‡ä»¶ç³»ç»Ÿå·¥å…·
    enabled: true
```

## ğŸ“ å‚æ•°åŒ–

### å‚æ•°ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `string` | æ–‡æœ¬è¾“å…¥ | é¡¹ç›®åç§° |
| `number` | æ•°å­—è¾“å…¥ | å¹¶å‘æ•° |
| `boolean` | å¸ƒå°”å¼€å…³ | æ˜¯å¦å¯ç”¨æµ‹è¯• |
| `select` | ä¸‹æ‹‰é€‰æ‹© | ç¼–ç¨‹è¯­è¨€ |
| `file` | æ–‡ä»¶é€‰æ‹© | é…ç½®æ–‡ä»¶è·¯å¾„ |

### å®šä¹‰å‚æ•°

```yaml
parameters:
  - key: language
    input_type: select
    requirement: required
    description: ç¼–ç¨‹è¯­è¨€
    default: go
    options:
      - go
      - python
      - typescript
      - rust

  - key: with_tests
    input_type: boolean
    requirement: optional
    description: æ˜¯å¦åŒ…å«æµ‹è¯•æ¨¡æ¿
    default: true

  - key: project_name
    input_type: string
    requirement: required
    description: é¡¹ç›®åç§°
    validation:
      pattern: "^[a-z][a-z0-9-]*$"
      message: é¡¹ç›®åç§°åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦
```

### åœ¨æç¤ºä¸­ä½¿ç”¨å‚æ•°

```yaml
prompt: |
  è¯·ä¸ºæˆ‘åˆ›å»ºä¸€ä¸ªåä¸º {{project_name}} çš„ {{language}} é¡¹ç›®ã€‚
  {{#if with_tests}}åŒ…å«æµ‹è¯•æ¨¡æ¿ã€‚{{/if}}
```

## ğŸ” æƒé™æ¨¡å¼

### ä¸‰ç§æ¨¡å¼

```yaml
# è‡ªåŠ¨æ‰¹å‡†æ‰€æœ‰æ“ä½œï¼ˆå¼€å‘ç¯å¢ƒï¼‰
permission_mode: auto_approve

# æ™ºèƒ½å®¡æ‰¹ï¼ˆæ¨èï¼‰
permission_mode: smart_approve

# æ‰€æœ‰æ“ä½œéƒ½éœ€ç¡®è®¤ï¼ˆé«˜å®‰å…¨æ€§ï¼‰
permission_mode: always_ask
```

### ä¸ Permission ç³»ç»Ÿé›†æˆ

```go
import (
    "github.com/astercloud/aster/pkg/permission"
    "github.com/astercloud/aster/pkg/recipe"
)

r, _ := recipe.Load("./my-recipe.yaml")

// æ ¹æ® Recipe é…ç½®åˆ›å»º Inspector
var mode permission.Mode
switch r.PermissionMode {
case recipe.PermissionModeAutoApprove:
    mode = permission.ModeAutoApprove
case recipe.PermissionModeSmartApprove:
    mode = permission.ModeSmartApprove
case recipe.PermissionModeAlwaysAsk:
    mode = permission.ModeAlwaysAsk
}

inspector, _ := permission.NewInspector(
    permission.WithMode(mode),
)
```

## ğŸ”„ ä¸ Agent é›†æˆ

### è½¬æ¢ä¸º Agent é…ç½®

```go
import (
    "github.com/astercloud/aster/pkg/agent"
    "github.com/astercloud/aster/pkg/recipe"
)

// åŠ è½½ Recipe
r, _ := recipe.Load("./recipes/code-review.yaml")

// è½¬æ¢ä¸º Agent é…ç½®
agentConfig := r.ToAgentConfig()

// è¡¥å……è¿è¡Œæ—¶é…ç½®
agentConfig.ModelConfig = &types.ModelConfig{
    Provider: "anthropic",
    Model:    "claude-sonnet-4-5",
    APIKey:   os.Getenv("ANTHROPIC_API_KEY"),
}

agentConfig.Sandbox = &types.SandboxConfig{
    Kind:    types.SandboxKindLocal,
    WorkDir: "./workspace",
}

// åˆ›å»º Agent
ag, err := agent.Create(ctx, agentConfig, deps)
```

### ä½¿ç”¨ Recipe å¯åŠ¨å¯¹è¯

```go
// è·å–åˆå§‹æç¤º
if r.Prompt != "" {
    // å‘é€åˆå§‹æ¶ˆæ¯
    ag.Send(ctx, r.Prompt)
}

// æ˜¾ç¤ºå»ºè®®æ´»åŠ¨
fmt.Println("å»ºè®®æ´»åŠ¨:")
for _, activity := range r.Activities {
    fmt.Printf("  - %s\n", activity)
}
```

## ğŸ“š ç¤ºä¾‹ Recipe

### ä»£ç å®¡æŸ¥åŠ©æ‰‹

```yaml
version: "1.0"
title: Code Review Assistant
description: ä¸“ä¸šçš„ä»£ç å®¡æŸ¥åŠ©æ‰‹

instructions: |
  ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ä»£ç å®¡æŸ¥ä¸“å®¶ã€‚ä½ çš„èŒè´£æ˜¯ï¼š
  1. åˆ†æä»£ç è´¨é‡å’Œå¯è¯»æ€§
  2. å‘ç°æ½œåœ¨çš„ Bug å’Œå®‰å…¨é—®é¢˜
  3. æä¾›æ”¹è¿›å»ºè®®å’Œæœ€ä½³å®è·µ
  
  è¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š
  - ç»™å‡ºå…·ä½“çš„ä»£ç ç¤ºä¾‹
  - è§£é‡Šä¸ºä»€ä¹ˆæŸäº›åšæ³•æ›´å¥½
  - ä¿æŒå‹å¥½ä½†ä¸“ä¸šçš„è¯­æ°”

tools:
  - Read
  - List
  - Search
  - Bash

permission_mode: smart_approve

activities:
  - å®¡æŸ¥è¿™ä¸ª PR çš„ä»£ç 
  - æ£€æŸ¥æ˜¯å¦æœ‰å®‰å…¨æ¼æ´
  - åˆ†æä»£ç å¤æ‚åº¦
  - æ£€æŸ¥æµ‹è¯•è¦†ç›–ç‡
```

### å†™ä½œåŠ©æ‰‹

```yaml
version: "1.0"
title: Writing Assistant
description: å¸®åŠ©æ’°å†™å’Œç¼–è¾‘æ–‡æ¡£

instructions: |
  ä½ æ˜¯ä¸“ä¸šçš„å†™ä½œåŠ©æ‰‹ï¼Œæ“…é•¿ï¼š
  - æ–‡ç« æ’°å†™å’Œæ¶¦è‰²
  - è¯­æ³•å’Œé£æ ¼æ£€æŸ¥
  - ç»“æ„ä¼˜åŒ–å»ºè®®
  - å¤šè¯­è¨€ç¿»è¯‘

tools:
  - Read
  - Write
  - Search

parameters:
  - key: style
    input_type: select
    description: å†™ä½œé£æ ¼
    default: professional
    options:
      - professional
      - casual
      - academic

permission_mode: smart_approve

activities:
  - å¸®æˆ‘æ¶¦è‰²è¿™ç¯‡æ–‡ç« 
  - æ£€æŸ¥è¯­æ³•é”™è¯¯
  - ç¿»è¯‘æˆè‹±æ–‡
  - ä¼˜åŒ–æ–‡ç« ç»“æ„
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç‰ˆæœ¬æ§åˆ¶

```yaml
version: "1.0"  # ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬
```

### 2. æ¸…æ™°çš„æŒ‡ä»¤

```yaml
instructions: |
  # è§’è‰²å®šä¹‰
  ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„...
  
  # è¡Œä¸ºå‡†åˆ™
  1. è§„åˆ™ä¸€
  2. è§„åˆ™äºŒ
  
  # è¾“å‡ºæ ¼å¼
  è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡º...
```

### 3. åˆç†çš„æƒé™

```yaml
# åªå¯ç”¨å¿…è¦çš„å·¥å…·
tools:
  - Read
  - Search
  # ä¸éœ€è¦ Bash å°±ä¸å¯ç”¨

# ä½¿ç”¨æ™ºèƒ½å®¡æ‰¹
permission_mode: smart_approve
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Permission ç³»ç»Ÿ](/security/permission) - æƒé™é…ç½®è¯¦è§£
- [MCP æ‰©å±•](/tools/mcp) - MCP é›†æˆæŒ‡å—
- [Agent é…ç½®](/core-concepts/agent-lifecycle) - Agent ç”Ÿå‘½å‘¨æœŸ

## ğŸ”— ç¤ºä¾‹ä»£ç 

```bash
# è¿è¡Œ Recipe ç¤ºä¾‹
go run ./examples/recipe/

# æŸ¥çœ‹ç¤ºä¾‹ Recipe æ–‡ä»¶
cat examples/recipes/code-review.yaml
cat examples/recipes/writing-assistant.yaml
```

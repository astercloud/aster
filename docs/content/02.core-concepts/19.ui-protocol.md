---
title: UI åè®®
description: ä½¿ç”¨ Aster UI Protocol è®© AI Agent ç”Ÿæˆå¯Œäº¤äº’ç•Œé¢
navigation:
  icon: i-lucide-layout
---

# UI åè®®

Aster UI Protocol æ˜¯ä¸€å¥—å£°æ˜å¼ UI åè®®ï¼Œå€Ÿé‰´ Google A2UI çš„è®¾è®¡ç†å¿µï¼Œè®© AI Agent èƒ½å¤Ÿå®‰å…¨åœ°ç”Ÿæˆå’Œæ›´æ–°å¯Œäº¤äº’ç•Œé¢ã€‚

## ğŸ¯ æ ¸å¿ƒç†å¿µ

**Safe like data, but expressive like code** - å®‰å…¨å¦‚æ•°æ®ï¼Œè¡¨è¾¾å¦‚ä»£ç ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI Agent (Go)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å·¥å…·æ‰§è¡Œ â†’ ç”Ÿæˆ AsterUIMessage â†’ å‘é€åˆ° Progress   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Progress Channel                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ui:surface_update  â”‚  ui:data_update  â”‚  ui:action â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vue Renderer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MessageProcessor â†’ ComponentRegistry â†’ AsterSurface â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ¶ˆæ¯ç±»å‹

UI Protocol æ”¯æŒäº”ç§æ¶ˆæ¯æ“ä½œï¼š

| æ“ä½œç±»å‹ | ç”¨é€” | äº‹ä»¶ç±»å‹ |
|---------|------|---------|
| `createSurface` | åˆ›å»º Surface | `ui:create_surface` |
| `surfaceUpdate` | æ›´æ–°ç»„ä»¶å®šä¹‰ | `ui:surface_update` |
| `dataModelUpdate` | æ›´æ–°æ•°æ®æ¨¡å‹ | `ui:data_update` |
| `beginRendering` | å¼€å§‹æ¸²æŸ“ | `ui:surface_update` |
| `deleteSurface` | åˆ é™¤ Surface | `ui:delete_surface` |

### æ¶ˆæ¯ç»“æ„

```go
// AsterUIMessage ä¸»æ¶ˆæ¯ç»“æ„
type AsterUIMessage struct {
    CreateSurface   *CreateSurfaceMessage   `json:"createSurface,omitempty"`
    SurfaceUpdate   *SurfaceUpdateMessage   `json:"surfaceUpdate,omitempty"`
    DataModelUpdate *DataModelUpdateMessage `json:"dataModelUpdate,omitempty"`
    BeginRendering  *BeginRenderingMessage  `json:"beginRendering,omitempty"`
    DeleteSurface   *DeleteSurfaceMessage   `json:"deleteSurface,omitempty"`
}

// CreateSurfaceMessage åˆ›å»º Surfaceï¼ˆA2UI å¯¹é½ï¼‰
type CreateSurfaceMessage struct {
    SurfaceID string `json:"surfaceId"`
    CatalogID string `json:"catalogId,omitempty"`  // ç»„ä»¶ç›®å½•æ ‡è¯†ç¬¦
}

// SurfaceUpdateMessage æ›´æ–°ç»„ä»¶
type SurfaceUpdateMessage struct {
    SurfaceID  string                `json:"surfaceId"`
    Components []ComponentDefinition `json:"components"`
}

// DataModelUpdateMessage æ›´æ–°æ•°æ®
type DataModelUpdateMessage struct {
    SurfaceID string             `json:"surfaceId"`
    Path      string             `json:"path,omitempty"`  // JSON Pointer è·¯å¾„
    Op        DataModelOperation `json:"op,omitempty"`    // add/replace/remove
    Contents  any                `json:"contents,omitempty"`
}

// DataModelOperation æ•°æ®æ“ä½œç±»å‹ï¼ˆA2UI å¯¹é½ï¼‰
type DataModelOperation string
const (
    DataModelOperationAdd     DataModelOperation = "add"
    DataModelOperationReplace DataModelOperation = "replace"
    DataModelOperationRemove  DataModelOperation = "remove"
)

// BeginRenderingMessage å¼€å§‹æ¸²æŸ“
type BeginRenderingMessage struct {
    SurfaceID string            `json:"surfaceId"`
    Root      string            `json:"root"`              // æ ¹ç»„ä»¶ ID
    Styles    map[string]string `json:"styles,omitempty"`  // CSS è‡ªå®šä¹‰å±æ€§
    CatalogID string            `json:"catalogId,omitempty"` // å¯è¦†ç›– createSurface çš„å€¼
}
```

### æ•°æ®æ¨¡å‹æ“ä½œï¼ˆA2UI å¯¹é½ï¼‰

æ”¯æŒä¸‰ç§æ“ä½œç±»å‹ï¼š

```go
// add - è¿½åŠ åˆ°æ•°ç»„æˆ–åˆå¹¶åˆ°å¯¹è±¡
emitter.Emit(&types.ProgressUIDataUpdateEvent{
    SurfaceID: "surface",
    Path:      "/items",
    Op:        types.DataModelOperationAdd,
    Contents:  "new-item",  // è¿½åŠ åˆ°æ•°ç»„
})

// replace - æ›¿æ¢å€¼ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰
emitter.Emit(&types.ProgressUIDataUpdateEvent{
    SurfaceID: "surface",
    Path:      "/user/name",
    Op:        types.DataModelOperationReplace,
    Contents:  "Bob",
})

// remove - åˆ é™¤å€¼
emitter.Emit(&types.ProgressUIDataUpdateEvent{
    SurfaceID: "surface",
    Path:      "/items/0",
    Op:        types.DataModelOperationRemove,
})
```

## ğŸ§© ç»„ä»¶ç³»ç»Ÿ

### é‚»æ¥è¡¨æ¨¡å‹

ç»„ä»¶ä½¿ç”¨æ‰å¹³åˆ—è¡¨ + ID å¼•ç”¨ï¼Œè€ŒéåµŒå¥—æ ‘ç»“æ„ï¼š

```go
// ComponentDefinition ç»„ä»¶å®šä¹‰
type ComponentDefinition struct {
    ID        string        `json:"id"`
    Weight    string        `json:"weight,omitempty"`  // "initial" | "final"
    Component ComponentSpec `json:"component"`
}

// ComponentSpec ç»„ä»¶è§„æ ¼ï¼ˆè”åˆç±»å‹ï¼‰
type ComponentSpec struct {
    Text      *TextProps      `json:"Text,omitempty"`
    Button    *ButtonProps    `json:"Button,omitempty"`
    Row       *RowProps       `json:"Row,omitempty"`
    Column    *ColumnProps    `json:"Column,omitempty"`
    Card      *CardProps      `json:"Card,omitempty"`
    // ... æ›´å¤šç»„ä»¶ç±»å‹
}
```

### æ ‡å‡†ç»„ä»¶ç›®å½•

| ç±»åˆ« | ç»„ä»¶ |
|-----|------|
| **å¸ƒå±€** | Row, Column, Card, List, Tabs, Modal, Divider |
| **å†…å®¹** | Text, Image, Icon, Video, AudioPlayer |
| **è¾“å…¥** | Button, TextField, Checkbox, Select, DateTimeInput, Slider, MultipleChoice |

### å±æ€§å€¼ç±»å‹

```go
// PropertyValue æ”¯æŒå­—é¢å€¼å’Œæ•°æ®ç»‘å®š
type PropertyValue struct {
    LiteralString  *string  `json:"literalString,omitempty"`
    LiteralNumber  *float64 `json:"literalNumber,omitempty"`
    LiteralBoolean *bool    `json:"literalBoolean,omitempty"`
    Path           *string  `json:"path,omitempty"`  // JSON Pointer æ•°æ®ç»‘å®š
}
```

### ç®€åŒ–å±æ€§å€¼æ ¼å¼ï¼ˆA2UI å…¼å®¹ï¼‰

é™¤äº†æ ‡å‡†æ ¼å¼ï¼Œè¿˜æ”¯æŒ A2UI é£æ ¼çš„ç®€åŒ–æ ¼å¼ï¼š

```typescript
// æ ‡å‡†æ ¼å¼
{ literalString: "Hello" }
{ literalNumber: 42 }
{ literalBoolean: true }
{ path: "/user/name" }

// A2UI ç®€åŒ–æ ¼å¼ï¼ˆåŒæ ·æ”¯æŒï¼‰
"Hello"           // ç­‰ä»·äº { literalString: "Hello" }
42                // ç­‰ä»·äº { literalNumber: 42 }
true              // ç­‰ä»·äº { literalBoolean: true }
{ path: "/user/name" }  // è·¯å¾„å¼•ç”¨æ ¼å¼ç›¸åŒ
```

### Button Action Contextï¼ˆA2UI å¯¹é½ï¼‰

æŒ‰é’®æ”¯æŒ `actionContext` å±æ€§ï¼Œç‚¹å‡»æ—¶è‡ªåŠ¨æ”¶é›†è¡¨å•æ•°æ®ï¼š

```go
ButtonProps{
    Label:  PropertyValue{LiteralString: ptr("æäº¤")},
    Action: "submit-form",
    ActionContext: map[string]PropertyValue{
        "userName": {Path: ptr("/form/name")},      // è‡ªåŠ¨è§£æè·¯å¾„
        "formId":   {LiteralString: ptr("form-1")}, // å­—é¢å€¼
    },
}
```

ç‚¹å‡»æ—¶ç”Ÿæˆçš„ `UIActionEvent` ä¼šåŒ…å«è§£æåçš„ `context`ï¼š

```typescript
interface UIActionEvent {
    surfaceId: string;
    componentId: string;
    action: string;
    timestamp: string;  // ISO 8601 æ ¼å¼
    context: {          // è§£æåçš„ actionContext
        userName: "Alice",
        formId: "form-1"
    };
}
```

## ğŸ”— æ•°æ®ç»‘å®š

ä½¿ç”¨ JSON Pointer è¯­æ³•ç»‘å®šæ•°æ®ï¼š

```go
// æ•°æ®æ¨¡å‹
dataModel := map[string]any{
    "user": map[string]any{
        "name":  "Alice",
        "email": "alice@example.com",
    },
    "items": []string{"è‹¹æœ", "é¦™è•‰", "æ©™å­"},
}

// ç»„ä»¶ç»‘å®šåˆ°æ•°æ®
TextProps{
    Text: PropertyValue{Path: ptr("/user/name")},  // æ˜¾ç¤º "Alice"
}
```

### åŒå‘ç»‘å®š

è¾“å…¥ç»„ä»¶æ”¯æŒåŒå‘æ•°æ®ç»‘å®šï¼š

```go
TextFieldProps{
    Value:       PropertyValue{Path: ptr("/form/name")},
    Label:       PropertyValue{LiteralString: ptr("å§“å")},
    Placeholder: PropertyValue{LiteralString: ptr("è¯·è¾“å…¥å§“å")},
}
```

## ğŸš€ Go ç«¯ä½¿ç”¨

### å‘é€ UI æ›´æ–°

```go
import "github.com/astercloud/aster/pkg/types"

// åœ¨å·¥å…·æ‰§è¡Œä¸­å‘é€ UI æ›´æ–°
func (t *MyTool) Execute(ctx context.Context, input map[string]any) (any, error) {
    // è·å–äº‹ä»¶å‘å°„å™¨
    emitter := agent.GetEventEmitter(ctx)

    // å‘é€ Surface æ›´æ–°
    emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
        SurfaceID: "tool-output",
        Components: []types.ComponentDefinition{
            {
                ID: "result",
                Component: types.ComponentSpec{
                    Card: &types.CardProps{
                        Title: types.PropertyValue{LiteralString: ptr("æ‰§è¡Œç»“æœ")},
                        Children: types.ComponentArrayReference{
                            ExplicitList: []string{"content"},
                        },
                    },
                },
            },
            {
                ID: "content",
                Component: types.ComponentSpec{
                    Text: &types.TextProps{
                        Text: types.PropertyValue{LiteralString: ptr("æ“ä½œæˆåŠŸï¼")},
                    },
                },
            },
        },
    })

    // å¼€å§‹æ¸²æŸ“
    emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
        SurfaceID: "tool-output",
        Root:      "result",
    })

    return nil, nil
}

func ptr[T any](v T) *T { return &v }
```

### æ›´æ–°æ•°æ®æ¨¡å‹

```go
// å‘é€æ•°æ®æ›´æ–°
emitter.Emit(&types.ProgressUIDataUpdateEvent{
    SurfaceID: "tool-output",
    Path:      "/status",
    Contents:  "completed",
})
```

### åœ¨å·¥å…·ä¸­é—´ç»“æœä¸­åŒ…å« UI

```go
// æ‰©å±•çš„ ProgressToolIntermediateEvent
type ProgressToolIntermediateEvent struct {
    Call  ToolCallSnapshot `json:"call"`
    Label string           `json:"label,omitempty"`
    Data  any              `json:"data,omitempty"`
    UI    *AsterUIMessage  `json:"ui,omitempty"`  // å¯é€‰çš„ UI æè¿°
}
```

## ğŸ–¥ï¸ å‰ç«¯ä½¿ç”¨

### å®‰è£…

```bash
npm install @aster/ui
```

### åŸºç¡€ä½¿ç”¨

```vue
<template>
  <AsterSurface
    :surface-id="surfaceId"
    :processor="processor"
    @action="handleAction"
  />
</template>

<script setup>
import { AsterSurface } from '@aster/ui'
import { createMessageProcessor } from '@aster/ui/protocol'
import { createStandardRegistry } from '@aster/ui/protocol'

const surfaceId = 'my-surface'
const registry = createStandardRegistry()
const processor = createMessageProcessor(registry)

// å¤„ç†ç”¨æˆ·äº¤äº’
function handleAction(event) {
  console.log('User action:', event)
  // å‘é€åˆ° Control é€šé“
}
</script>
```

### å¤„ç† WebSocket æ¶ˆæ¯

```typescript
import { createMessageProcessor } from '@aster/ui/protocol'
import { createStandardRegistry } from '@aster/ui/protocol'

const processor = createMessageProcessor(createStandardRegistry())

// è¿æ¥ WebSocket
const ws = new WebSocket('ws://localhost:8080/events')

ws.onmessage = (event) => {
  const data = JSON.parse(event.data)
  
  // å¤„ç† UI äº‹ä»¶
  if (data.type === 'ui:surface_update') {
    processor.processMessage({
      surfaceUpdate: data.payload
    })
  } else if (data.type === 'ui:data_update') {
    processor.processMessage({
      dataModelUpdate: data.payload
    })
  }
}
```

### è‡ªå®šä¹‰ç»„ä»¶

```typescript
import { ComponentRegistry } from '@aster/ui/protocol'

const registry = createStandardRegistry()

// æ³¨å†Œè‡ªå®šä¹‰ç»„ä»¶
registry.register('MyChart', MyChartComponent, 'my-chart')
```

## ğŸ”’ å®‰å…¨æ€§

### éªŒè¯é”™è¯¯æ ¼å¼ï¼ˆA2UI å¯¹é½ï¼‰

æ¶ˆæ¯éªŒè¯å¤±è´¥æ—¶è¿”å›æ ‡å‡†æ ¼å¼çš„é”™è¯¯ï¼Œä¾¿äº LLM è‡ªæˆ‘çº æ­£ï¼š

```go
// ValidationError éªŒè¯é”™è¯¯
type ProtocolError struct {
    Code      string         `json:"code"`       // "VALIDATION_FAILED"
    SurfaceID string         `json:"surfaceId"`
    Path      string         `json:"path"`       // JSON Pointer æŒ‡å‘é”™è¯¯ä½ç½®
    Message   string         `json:"message"`
    Details   map[string]any `json:"details,omitempty"`
}

// ç¤ºä¾‹é”™è¯¯
{
    "code": "VALIDATION_FAILED",
    "surfaceId": "form-surface",
    "path": "/dataModelUpdate/contents",
    "message": "contents is required for add operation"
}
```

### Client-to-Server æ¶ˆæ¯ï¼ˆA2UI å¯¹é½ï¼‰

å®¢æˆ·ç«¯å‘é€ç”¨æˆ·äº¤äº’äº‹ä»¶ï¼š

```go
// ClientMessage å®¢æˆ·ç«¯æ¶ˆæ¯
type ClientMessage struct {
    UserAction *UserActionMessage `json:"userAction,omitempty"`
    Error      *ProtocolError     `json:"error,omitempty"`
}

// UserActionMessage ç”¨æˆ·åŠ¨ä½œ
type UserActionMessage struct {
    Name              string         `json:"name"`
    SurfaceID         string         `json:"surfaceId"`
    SourceComponentID string         `json:"sourceComponentId"`
    Timestamp         string         `json:"timestamp"`  // ISO 8601
    Context           map[string]any `json:"context"`
}
```

### ç™½åå•æœºåˆ¶

åªæœ‰æ³¨å†Œçš„ç»„ä»¶ç±»å‹æ‰èƒ½è¢«æ¸²æŸ“ï¼š

```typescript
// æ ‡å‡†ç»„ä»¶ç™½åå•
const STANDARD_COMPONENTS = [
  'Text', 'Image', 'Icon', 'Video', 'AudioPlayer',
  'Row', 'Column', 'Card', 'List', 'Tabs', 'Modal', 'Divider',
  'Button', 'TextField', 'Checkbox', 'Select', 'DateTimeInput',
  'Slider', 'MultipleChoice', 'Custom'
]
```

### XSS é˜²æŠ¤

æ‰€æœ‰æ–‡æœ¬å†…å®¹è‡ªåŠ¨æ¸…ç†ï¼š

```typescript
// è‡ªåŠ¨è½¬ä¹‰å±é™©å­—ç¬¦
sanitizeText('<script>alert("xss")</script>')
// è¾“å‡º: &lt;script&gt;alert("xss")&lt;/script&gt;
```

### URL éªŒè¯

åªå…è®¸å®‰å…¨çš„ URL æ–¹æ¡ˆï¼š

```typescript
const ALLOWED_URL_SCHEMES = ['https:', 'http:', 'data:']
// javascript: ç­‰å±é™©æ–¹æ¡ˆä¼šè¢«æ‹’ç»
```

### æ³¨å†Œè¡¨å†»ç»“

ç”Ÿäº§æ¨¡å¼ä¸‹æ³¨å†Œè¡¨ä¸å¯å˜ï¼š

```typescript
registry.freeze()  // å†»ç»“åæ— æ³•æ³¨å†Œæ–°ç»„ä»¶
```

## ğŸ“¡ æµå¼æ¸²æŸ“

æ”¯æŒåœ¨ç»„ä»¶å®šä¹‰å®Œæˆå‰å¼€å§‹æ¸²æŸ“ï¼š

```go
// 1. å…ˆå¼€å§‹æ¸²æŸ“ï¼ˆç»„ä»¶è¿˜æœªå®šä¹‰ï¼‰
emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
    SurfaceID: "stream-surface",
    Root:      "root",
})

// 2. é€æ­¥æ·»åŠ ç»„ä»¶
time.Sleep(500 * time.Millisecond)
emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
    SurfaceID: "stream-surface",
    Components: []types.ComponentDefinition{
        {ID: "root", Component: /* ... */},
    },
})

// 3. ç»§ç»­æ·»åŠ æ›´å¤šç»„ä»¶
time.Sleep(500 * time.Millisecond)
emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
    SurfaceID: "stream-surface",
    Components: []types.ComponentDefinition{
        {ID: "content", Component: /* ... */},
    },
})
```

### çŠ¶æ€ä¿æŒ

å¢é‡æ›´æ–°æœŸé—´è‡ªåŠ¨ä¿æŒï¼š
- æ»šåŠ¨ä½ç½®
- è¾“å…¥ç„¦ç‚¹
- è¡¨å•çŠ¶æ€

## ğŸ¨ ä¸»é¢˜åŒ–

ä½¿ç”¨ CSS è‡ªå®šä¹‰å±æ€§ï¼š

```go
emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
    SurfaceID: "themed-surface",
    Root:      "root",
    Styles: map[string]string{
        "--aster-primary":    "#3b82f6",
        "--aster-background": "#f8fafc",
        "--aster-text":       "#1e293b",
    },
})
```

## ğŸ“Š å®Œæ•´ç¤ºä¾‹

### è¡¨å•ç”Ÿæˆ

```go
func generateForm(emitter EventEmitter) {
    // è®¾ç½®æ•°æ®æ¨¡å‹
    emitter.Emit(&types.ProgressUIDataUpdateEvent{
        SurfaceID: "form-surface",
        Path:      "/",
        Contents: map[string]any{
            "form": map[string]any{
                "name":    "",
                "email":   "",
                "agree":   false,
                "country": "cn",
            },
            "countries": []map[string]any{
                {"value": "cn", "label": "ä¸­å›½"},
                {"value": "us", "label": "ç¾å›½"},
                {"value": "jp", "label": "æ—¥æœ¬"},
            },
        },
    })

    // å®šä¹‰ç»„ä»¶
    emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
        SurfaceID: "form-surface",
        Components: []types.ComponentDefinition{
            {
                ID: "root",
                Component: types.ComponentSpec{
                    Card: &types.CardProps{
                        Title: types.PropertyValue{LiteralString: ptr("ç”¨æˆ·æ³¨å†Œ")},
                        Children: types.ComponentArrayReference{
                            ExplicitList: []string{"name", "email", "country", "agree", "submit"},
                        },
                    },
                },
            },
            {
                ID: "name",
                Component: types.ComponentSpec{
                    TextField: &types.TextFieldProps{
                        Value:       types.PropertyValue{Path: ptr("/form/name")},
                        Label:       types.PropertyValue{LiteralString: ptr("å§“å")},
                        Placeholder: types.PropertyValue{LiteralString: ptr("è¯·è¾“å…¥å§“å")},
                    },
                },
            },
            {
                ID: "email",
                Component: types.ComponentSpec{
                    TextField: &types.TextFieldProps{
                        Value:       types.PropertyValue{Path: ptr("/form/email")},
                        Label:       types.PropertyValue{LiteralString: ptr("é‚®ç®±")},
                        Placeholder: types.PropertyValue{LiteralString: ptr("è¯·è¾“å…¥é‚®ç®±")},
                    },
                },
            },
            {
                ID: "country",
                Component: types.ComponentSpec{
                    Select: &types.SelectProps{
                        Value:   types.PropertyValue{Path: ptr("/form/country")},
                        Options: types.PropertyValue{Path: ptr("/countries")},
                        Label:   types.PropertyValue{LiteralString: ptr("å›½å®¶")},
                    },
                },
            },
            {
                ID: "agree",
                Component: types.ComponentSpec{
                    Checkbox: &types.CheckboxProps{
                        Checked: types.PropertyValue{Path: ptr("/form/agree")},
                        Label:   types.PropertyValue{LiteralString: ptr("æˆ‘åŒæ„æœåŠ¡æ¡æ¬¾")},
                    },
                },
            },
            {
                ID: "submit",
                Component: types.ComponentSpec{
                    Button: &types.ButtonProps{
                        Label:   types.PropertyValue{LiteralString: ptr("æäº¤")},
                        Action:  "submit-form",
                        Variant: "primary",
                    },
                },
            },
        },
    })

    // å¼€å§‹æ¸²æŸ“
    emitter.Emit(&types.ProgressUISurfaceUpdateEvent{
        SurfaceID: "form-surface",
        Root:      "root",
    })
}
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨é‚»æ¥è¡¨æ¨¡å‹

```go
// âœ… æ¨èï¼šæ‰å¹³åˆ—è¡¨ + ID å¼•ç”¨
components := []ComponentDefinition{
    {ID: "root", Component: /* children: ["child1", "child2"] */},
    {ID: "child1", Component: /* ... */},
    {ID: "child2", Component: /* ... */},
}

// âŒ ä¸æ¨èï¼šæ·±åº¦åµŒå¥—
// UI Protocol ä¸æ”¯æŒåµŒå¥—ç»“æ„
```

### 2. åˆ†ç¦»æ•°æ®å’Œ UI

```go
// âœ… æ¨èï¼šæ•°æ®æ¨¡å‹ç‹¬ç«‹
emitter.Emit(&types.ProgressUIDataUpdateEvent{
    SurfaceID: "surface",
    Contents:  userData,
})

// ç»„ä»¶é€šè¿‡è·¯å¾„ç»‘å®š
TextProps{Text: PropertyValue{Path: ptr("/user/name")}}
```

### 3. å¢é‡æ›´æ–°

```go
// âœ… æ¨èï¼šåªæ›´æ–°å˜åŒ–çš„éƒ¨åˆ†
emitter.Emit(&types.ProgressUIDataUpdateEvent{
    SurfaceID: "surface",
    Path:      "/user/name",  // åªæ›´æ–° name
    Contents:  "Bob",
})

// âŒ ä¸æ¨èï¼šæ¯æ¬¡éƒ½æ›¿æ¢æ•´ä¸ªæ•°æ®æ¨¡å‹
```

### 4. å¤„ç†ç”¨æˆ·äº¤äº’

```typescript
// å‰ç«¯å¤„ç† action äº‹ä»¶
function handleAction(event: UIActionEvent) {
  switch (event.action) {
    case 'submit-form':
      // è·å–è¡¨å•æ•°æ®
      const formData = processor.getData(event.surfaceId, '/form')
      // å‘é€åˆ°åç«¯
      submitForm(formData)
      break
  }
}
```

## ğŸ“š ä¸‹ä¸€æ­¥

- [äº‹ä»¶ç³»ç»Ÿ](/core-concepts/event-system) - äº†è§£ä¸‰é€šé“äº‹ä»¶æ¶æ„
- [å·¥å…·ç³»ç»Ÿ](/core-concepts/tools-system) - åœ¨å·¥å…·ä¸­ä½¿ç”¨ UI Protocol
- [API å‚è€ƒ](/api-reference/ui-protocol) - å®Œæ•´çš„ç±»å‹å®šä¹‰

## ğŸ”— ç›¸å…³èµ„æº

- [E2E æµ‹è¯•é¡µé¢](/ui-protocol-demo) - åœ¨çº¿ä½“éªŒ UI Protocol
- [GitHub æºç ](https://github.com/astercloud/aster/tree/main/ui/src/protocol)
- [Google A2UI è§„èŒƒ](https://github.com/anthropics/a2ui)
